---
title: "ac - Create Weekly with GitHub or GitLab"
output: rmarkdown::html_vignette
chunk_output_type: "console"
vignette: >
  %\VignetteIndexEntry{ac-create-weekly-with-github-or-gitlab}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(lozen)
```

<!-- WARNING - This vignette is generated by {fusen} from /dev/flat_create_weekly.Rmd: do not edit by hand -->

```{r message = FALSE}
library(gh)
library(dplyr)
library(purrr)
library(tidyr)
library(glue)
library(stringr)
library(stringi)
library(forcats)
library(ggplot2)
library(scales)
library(gitlabr)
library(lubridate)
```

# Create a weekly for GitHub with `gh_create_weekly_old_and_new_boards()` (old and new boards)

This functions allow querying the last and the former versions of the Github API to retrieve the status of the project board.

Please note that if you wish to work with the last version of Github board, you must have created a token and put it on a environment variable.

By default, the function uses the `GITHUB_PAT` environment variable. Please ensure that the read:project scope is provided with your token.

Please visit the [API documentation] (https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-api-to-manage-projects?tool=cli#finding-information-about-items-in-a-project) to generate a token with such privileges.


  

```{r example-gh_create_weekly_old_and_new_boards, error = TRUE}
#' \dontrun{
user <- "ThinkR-open"
repo <- "example-weekly"
date_min <- "2022-06-30"
date_max <- "2022-06-30"
board_url_old <- glue::glue("/repos/{user}/{repo}/projects")
board_url_new <- "https://github.com/orgs/ThinkR-open/projects/4/"

# old board
weekly_old <- gh_create_weekly_old_and_new_boards(
  date_min = date_min,
  date_max = date_max,
  user = user,
  repo = repo,
  board_url = board_url_old,
  new_board = FALSE,
  verbose = FALSE
)
cat(weekly_old$weekly_info)

# clipr::write_clip(weekly_old$weekly_info)


# new board
weekly_new <- gh_create_weekly_old_and_new_boards(
  date_min = date_min,
  date_max = date_max,
  user = user,
  repo = repo,
  board_url = board_url_new,
  github_token = Sys.getenv("GITHUB_PAT"),
  new_board = TRUE,
  verbose = FALSE
)
cat(weekly_new$weekly_info)
# clipr::write_clip(weekly_new$weekly_info)

#' }
```

  

  


# Create a weekly for GitHub with `gh_create_weekly()` (old board only)

Please note that you should use the function `gh_create_weekly_old_and_new_boards()` instead.
    

  

```{r example-gh_create_weekly, error = TRUE}
#' \dontrun{
if (Sys.getenv("GITHUB_PAT") != "") {
  user <- "ThinkR-open"
  repo <- "example-weekly"
  weekly <- gh_create_weekly(
    date_min = "2022-06-30",
    date_max = "2022-06-30",
    user = user,
    repo = repo,
    board_url = glue::glue("/repos/{user}/{repo}/projects")
  )
}
#' }
# Copier dans le presse papier pour copier directement
# clipr::write_clip(weekly$weekly_info)
```

  

  

# Create a weekly for GitHub with `gh_create_weekly_new_projects_board()` (new board only)    

## Query GraphQL Github API

This functions allow querying the last version of the Github API to retrieve the status of the project board.

By default, it uses the `GITHUB_PAT` environment variable. Please ensure that the read:project scope is provided with your token.

Please visit the [API documentation] (https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-api-to-manage-projects?tool=cli#finding-information-about-items-in-a-project) to generate a token with such privileges.



  

```{r example-graphql_to_tibble, eval = FALSE}
#' \dontrun{

# Example with board hosted in an organization github account
board_url_organization <- "https://github.com/orgs/ThinkR-open/projects/4/"
github_token <- Sys.getenv("GITHUB_PAT")

graphql_to_tibble(
  board_url = board_url_organization,
  github_token = github_token
)


# Example with board hosted in a user github account
board_url_user <- "https://github.com/users/the-thinkr/projects/1"
github_token <- Sys.getenv("GITHUB_PAT")

graphql_to_tibble(
  board_url = board_url_user,
  github_token = github_token
)

#' }
```

  

  

## Create the weekly

Please note that you should use the function `gh_create_weekly_old_and_new_boards()` instead.


  

```{r example-gh_create_weekly_new_projects_board, error = TRUE}
#' \dontrun{
board_url <- "https://github.com/orgs/ThinkR-open/projects/4/"
date_min <- "2022-06-30"
date_max <- "2022-06-30"
user <- "ThinkR-open"
repo <- "example-weekly"

if (Sys.getenv("GITHUB_PAT") != "") {
  weekly <- gh_create_weekly_new_projects_board(
    date_min = date_min,
    date_max = date_max,
    user = user,
    repo = repo,
    board_url = board_url,
    github_token = Sys.getenv("GITHUB_PAT"),
    verbose = FALSE
  )
}
#' }
# Copier dans le presse papier pour copier directement
# clipr::write_clip(weekly$weekly_info)
```

  

  


# Create a weekly for GitLab with `gl_create_weekly()`

    


  

```{r eval = FALSE}
#' \dontrun{
# example-weekly = 37585948 (on GitLab.com)
out <- gl_create_weekly(
  project_id = "<get_your_id_project>",
  date_min = Sys.Date() - 7,
  private_token = Sys.getenv("GITLAB_TOKEN")
)
cat(out$weekly_info)
# Copier dans le presse papier pour copier directement
# clipr::write_clip(out$weekly_info)

# Get the daily weekly for a past day
out_past <- gl_create_daily(
  project_id = "<get_your_id_project>",
  date_daily = "2022-07-20",
  private_token = Sys.getenv("GITLAB_TOKEN")
)
cat(out_past$weekly_info)

# Get the daily weekly for a today
out_today <- gl_create_daily(
  project_id = "<get_your_id_project>",
  private_token = Sys.getenv("GITLAB_TOKEN")
)
cat(out_today$weekly_info)

# Copier dans le presse papier pour copier directement
# clipr::write_clip(out$weekly_info)
#' }
```

  

# Visualise the nature of the developments for GitLab with `visualise_commits()`

 
Only the main branch is considered.


  

```{r example-visualise_commits, eval = FALSE}
#' \dontrun{

  visualise_commits(
    project_id = "<get_your_id_project>",
    gitlab_url = Sys.getenv("GITLAB_URL", unset = "https://gitlab.com"),
    date_min = "2022-09-22",
    date_max = "2022-09-29",
    private_token = Sys.getenv("GITLAB_TOKEN")
  )

  # Or on project already cloned
  tempdir <-
    clone_locally(full_url = "https://gitlab.com/my_name/my_repo", open = FALSE)

  visualise_commits(
    path = tempdir,
    date_min = "2022-09-22",
    date_max = "2022-09-29"
  )
}
```

  

  

# Visualise the progress of the milestones for GitLab with `gl_get_milestones_progress()`

    

  

```{r example-gl_get_milestones_progress, eval = FALSE}
#' \dontrun{
gl_get_milestones_progress(
  project_id = "<get_your_id_project>",
  private_token = Sys.getenv("GITLAB_TOKEN")
)
#' }
```

  

  



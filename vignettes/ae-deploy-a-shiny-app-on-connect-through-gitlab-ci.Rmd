---
title: "ae - Deploy a {golem} app on Posit Connect and its pkgdown on Gitlab Pages through GitLab CI/CD"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ae-deploy-a-shiny-app-on-connect-through-gitlab-ci}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(lozen)
```

For the following to be working, please ensure you are working in a shiny app initiated with {golem}. Your app project must be associated with a repository present on Gitlab.

If this is not done yet please go to the vignette `vignettes/aa-create-a-new-project-with-gitlab.Rmd` and follow theses sections:

- Define the name of the principal branch
- Connection to GitLab
- Create a new project or use an existing project
- Clone your project and add the skeleton for your product (package, app, bookdown)
  + Create the skeleton for your product and initiate the CI/CD
    + Shiny app


Before running the following commands please ensure that you are working on your golem app project.

# Add an app.R at the root of your package to deploy on RStudio Connect 

```{r, eval=FALSE}
golem::add_rstudioconnect_file()
```


# Initiate the deployment of your app

## To be done on your R project

```{r, eval=FALSE}
use_gitlab_ci_deploy_connect_shiny()
```

The `.gitlab-ci.yml` file, which was already present in your project is you followed the process described in the vignette `vignettes/aa-create-a-new-project-with-gitlab.Rmd`, is now completed with new staged, specific to the deployment on Connect.

## To be done on Gitlab

Some environment variables must be set on Gitlab for the CI/CD to be working.

You'll need to define : 

```{r, eval=FALSE}
CONNECT_URL <- "https://my.connect.url"
CONNECT_NAME <- "my.connect.server.name"
CONNECT_USER <- "my.connect.username"
CONNECT_TOKEN <- "my.api.key.generated.in.connect"
APP_NAME <- "the.name.of.your.app.on.connect"
GITHUB_PAT <- "my.personal.access.token.generated.in.github"
```

For most of them, you may have already set them on your `.Renviron` file (see the dedicated section on the {lozen} README).

If you are not familiar with defining environement variable on gitlab, please follow the [official documentation](https://docs.gitlab.com/ee/ci/variables/index.html).

Once this is done, you can commit all your changes and push them to your repository remote.

Thereafter, you should be able to [see your pipeline running](https://docs.gitlab.com/ee/ci/pipelines/#view-pipelines) on Gitlab.

# How can I find the pkgdown associated with my {golem} package

If your pipeline did not raise any error, the deployed pkgdown is now hosted on [Gitlab pages](https://docs.gitlab.com/ee/user/project/pages/getting_started_part_one.html).

If you are working on `https://gitlab.com`, the pkgdown url should be `https://username.gitlab.io/your.repository.name`. 


# How can I find the app associated with my {golem} package

If your pipeline did not raise any error, you app is now deployed on your Posit Connect. You can now log in your Posit Connect and enjoy your app !
